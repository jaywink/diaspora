-#   Copyright (c) 2010-2011, Diaspora Inc.  This file is
-#   licensed under the Affero General Public License version 3 or later.  See
-#   the COPYRIGHT file.

- content_for :page_title do
  = t('.edit_profile')

= form_tag profile_path, :method => :put, :multipart => true, :id => 'update_profile_form' do
  / = render 'profiles/edit_public', :profile => profile, :aspect => aspect, :person => person

  - content_for :head do
    = javascript_include_tag :profile
    
  :javascript
    $(document).ready(function () {
      var data = $.parseJSON( '#{@tags_array.to_json.gsub("'", "\\\\'")}' ),
          autocompleteInput = $("#profile_tag_string");

      autocompleteInput.autoSuggest("#{tags_path}", {
        selectedItemProp: "name",
        selectedValuesProp: "name",
        searchObjProps: "name",
        asHtmlID: "tags",
        neverSubmit: true,
        retrieveLimit: 10,
        minChars: 2,
        keyDelay: 200,
        startText: "",
        emptyText: "#{t('no_results')}",
        preFill: data
        });

      autocompleteInput.bind('keydown', function(evt){
        if(evt.keyCode == 13 || evt.keyCode == 9 || evt.keyCode == 32){
          evt.preventDefault();
          if( $('li.as-result-item.active').length == 0 ){
            $('li.as-result-item').first().click();
          }
        }
      });
    });


  %h3{:class=>"inline"}
    = t('profiles.edit.basic')
  = image_tag 'icons/globe.png'
  %br
  %br

  = error_messages_for profile

  %h4
    = t('profiles.edit.your_name')
  = label_tag 'profile[first_name]', t('profiles.edit.first_name')
  = text_field_tag 'profile[first_name]', profile.first_name

  = label_tag 'profile[first_name]', t('profiles.edit.last_name')
  = text_field_tag 'profile[last_name]', profile.last_name

  %br

  %h4
    = t('profiles.edit.your_tags')

  = text_field_tag 'profile[tag_string]', "", :placeholder => t('profiles.edit.your_tags_placeholder')

  %br

  %h4
    = t('profiles.edit.your_photo')

  = render 'photos/new_profile_photo', :aspect => aspect, :person => person

  %br

  %hr

  %h3{:class=>"inline"}
    = t('profiles.edit.additional')
  = image_tag 'icons/globe.png', class: 'additional-visibility-icon', style: ('display:none;' if ! profile.is_public)
  = image_tag 'icons/padlock-closed.png', class: 'additional-visibility-icon', style: ('display:none;' if profile.is_public)
  %span{ :rel => 'facebox', :title => t('profiles.edit.additional_hint') }
    = image_tag 'icons/monotone_question.png'
  = check_box_tag 'profile[is_public]', true, profile.is_public
  %br
  %br

  %h4
    = t('profiles.edit.your_bio')
  = text_area_tag 'profile[bio]', profile.bio, :rows => 5, :placeholder => t('fill_me_out')

  %br

  %h4
    = t('profiles.edit.your_location')
  = text_field_tag 'profile[location]', profile.location, :placeholder => t('fill_me_out')


  %br

  %h4
    = t('profiles.edit.your_gender')
  = text_field_tag 'profile[gender]', profile.gender, :placeholder => t("fill_me_out")

  %br

  %h4
    = t('profiles.edit.your_birthday')
  = select_date profile.birthday, :prompt => true,
    :default => true, :order => t('date.order'), :start_year => 2000, :end_year => 1930, :prefix => 'profile[date]'

  %br
  %br
  
  %hr
  %h3{:class=>"inline"}
    = t('profiles.edit.settings')
  = image_tag 'icons/padlock-closed.png'

  %br
  %br
  
  %h4
    = t('search')

  %p{:class=>"checkbox_select"}
    = label_tag 'profile[searchable]', t('profiles.edit.allow_search')
    = check_box_tag 'profile[searchable]', true, profile.searchable
  %br
  %br

  %h4= t('nsfw')
  %p.nsfw_explanation=profile.nsfw? ? t('.you_are_nsfw') : t('.you_are_safe_for_work')
  %p{:class=>"checkbox_select"}
    = check_box_tag 'profile[nsfw]', true, profile.nsfw?
    = label_tag 'profile[nsfw]', "nsfw?"
  %br
  %br

  .submit_block
    =yield(:submit_block)

